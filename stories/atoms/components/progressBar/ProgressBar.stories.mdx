import { ArgsTable, Meta, Story, Canvas, Preview, Props } from '@storybook/addon-docs'
import { ProgressBar } from 'ui/atoms/progressBar/ProgressBar'
import { ThemeProvider } from 'ui/atoms/theme/ThemeProvider'
import { ThemeSwitcher } from 'ui/atoms/theme/ThemeSwitcher'
import { useState } from 'react'

<Meta
  title="Atoms/ProgressBar"
  component={ProgressBar}
  parameters={{
    actions: { argTypesRegex: '^on.*' },
    docs: {
      source: {
        type: 'code'
      }
    }
  }}
  decorators={[
    Story => (
      <ThemeProvider>
        <div className="component-story-main">
          <ThemeSwitcher />
          <div
            style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              gap: '25px'
            }}
          >
            <Story />
          </div>
        </div>
      </ThemeProvider>
    )
  ]}
/>

# ProgressBar

> Show the progress of a treatment

[![stability-unstable](https://img.shields.io/badge/stability-unstable-yellow.svg)](https://github.com/emersion/stability-badges#unstable)

## Overview

### Description

The `ProgressBar` component display a bar of progress of any treatment. The component size is full width so is the parent responsibility to manage the size.

<Canvas>
  <Story
    name="Overview"
    argTypes={{
      icon: {
        control: false,
        table: {
          type: { summary: 'Icon' }
        }
      }
    }}
    args={{
      label: 'okp4.png',
      minValue: 0,
      maxValue: 1.3789,
      currentValue: 0.99
    }}
  >
    {args => {
      const progressValueFormatter = (currentValue, minValue, maxValue) => {
        const total = maxValue >= minValue ? maxValue - minValue : 0
        const current = currentValue ? currentValue - minValue : 0
        return `${(total && 0 <= current && current <= total ? (100 * current) / total : 0).toFixed(
          2
        )}%`
      }
      const [time, setTime] = useState(0)
      return (
        <ProgressBar
          {...args}
          currentValueFormatter={currentValue => `${currentValue.toFixed(2)} Mo`}
          progressValueFormatter={progressValueFormatter}
        />
      )
    }}
  </Story>
</Canvas>

---

### Properties

<ArgsTable story="Overview" />

## Label

The `label` property allows to display a label concerning the progress such as a file name during an upload.

<Canvas>
  <Story name="Label">
    {() => {
      return <ProgressBar label="Image1.png" />
    }}
  </Story>
</Canvas>

---

## Current value, minimum value and maximum value

The `minValue` and `maxValue` properties are used to calculate the current progress of the `currentValue` property.
By default the `minValue` is set to `0` and `maxValue` is set to `100`. So the user can provide only `currentValue` and except to see the progress in percentage.
If `currentValue` is not provided or there is inconsistency between `minValue`, `maxValue` and `currentValue`, then the progress bar will be displayed in an indeterminated mode.

<Canvas>
  <Story name="Values">
    {() => {
      return (
        <div
          style={{
            display: 'grid',
            width: '95%',
            gap: '25px'
          }}
        >
          <ProgressBar label="okp4.pdf" minValue={0} maxValue={195} currentValue={23} />
          <ProgressBar label="Negative values" minValue={-235} maxValue={100} currentValue={-10} />
          <ProgressBar label="Image2.png" minValue={0} maxValue={20} currentValue={12.48795} />
          <ProgressBar label="Min greather than Max" minValue={10} maxValue={0} currentValue={7} />
          <ProgressBar
            label="Value greather than max bound"
            minValue={0}
            maxValue={50}
            currentValue={75}
          />
          <ProgressBar
            label="Value less than min bound"
            minValue={10}
            maxValue={50}
            currentValue={5}
          />
          <ProgressBar label="Value not provided" minValue={0} maxValue={100} />
        </div>
      )
    }}
  </Story>
</Canvas>

---

## Format displayed values

It is possible to provide `currentValueFormatter` and `progressValueFormatter` functions to define how to display the current value and the current progress.
By default, the current value is not formatted and the progress value is displayed as a percentage of the progress.

<Canvas>
  <Story name="Format values">
    {() => {
      const currentValueFormatterTemp = currentValue => `${currentValue.toFixed(0)} 째C`
      const progressValueFormatterTemp = (currentValue, minValue, maxValue) =>
        `${minValue}째C  to ${maxValue}째C (${currentValue.toFixed(1)}째C)`
      const currentValueFormatterUpload = currentValue => null
      const progressValueFormatterUpload = (currentValue, minValue, maxValue) =>
        `${currentValue} images uploaded on ${maxValue}`
      const currentValueFormatterDownload = currentValue => `${currentValue.toFixed(2)} Go`
      const progressValueFormatterDownload = (currentValue, minValue, maxValue) =>
        `${(maxValue - currentValue).toFixed(2)} Go remaining on ${maxValue} Go`
      return (
        <div
          style={{
            display: 'grid',
            width: '95%',
            gap: '25px'
          }}
        >
          <ProgressBar
            label="Temperature"
            minValue={-10}
            maxValue={50}
            currentValue={25}
            currentValueFormatter={currentValueFormatterTemp}
            progressValueFormatter={progressValueFormatterTemp}
          />
          <ProgressBar
            label="Upload images"
            minValue={0}
            maxValue={125}
            currentValue={44}
            currentValueFormatter={currentValueFormatterUpload}
            progressValueFormatter={progressValueFormatterUpload}
          />
          <ProgressBar
            label="Downloaded files"
            minValue={0}
            maxValue={3.5}
            currentValue={0.9785}
            currentValueFormatter={currentValueFormatterDownload}
            progressValueFormatter={progressValueFormatterDownload}
          />
        </div>
      )
    }}
  </Story>
</Canvas>

---

## Icon

An `Icon` can be provided to give more visual information such as a hourglass during the progress time or a red cross if the progress is interupted or a green check when the progress is completed.

<Canvas>
  <Story name="Icon">
    {() => {
      return (
        <div
          style={{
            display: 'grid',
            width: '95%',
            gap: '25px'
          }}
        >
          <ProgressBar label="Read pages" minValue={0} maxValue={20} currentValue={12} />
          <ProgressBar label="An error occured" minValue={0} maxValue={15} />
          <ProgressBar label="Lesson completed !" minValue={0} maxValue={20} currentValue={20} />
        </div>
      )
    }}
  </Story>
</Canvas>
