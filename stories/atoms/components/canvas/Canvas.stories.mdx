import { ArgsTable, Meta, Story, Canvas, Preview, Props } from '@storybook/addon-docs'
import { Canvas as CanvasComponent } from 'ui/atoms/canvas/Canvas'
import { useElementSize } from 'hook/useElementSize'

<Meta
  title="Atoms/Canvas"
  component={CanvasComponent}
  parameters={{ actions: { argTypesRegex: '^on.*' } }}
/>

# Canvas

> A simple [canvas](https://www.w3schools.com/html/html5_canvas.asp) React component.

[![stability-unstable](https://img.shields.io/badge/stability-unstable-yellow.svg)](https://github.com/emersion/stability-badges#unstable)

## Overview

### Description

The `Canvas` component offers a seamless integration of the regular [canvas](https://www.w3schools.com/html/html5_canvas.asp) HTML element in React, so we can
just draw inside it like we usually do on the fly, via JavaScript.

---

export let counter = 0
export const draw = (canvas, deltaCount) => {
  const ctx = canvas.getContext('2d')
  const nbDots = 5
  counter += deltaCount
  ctx.rect(0, 0, canvas.width, canvas.height)
  ctx.fillStyle = '#000000'
  ctx.fill()
  ctx.beginPath()
  ctx.fillStyle = '#ffffff'
  for (let i = 0; i < nbDots; i++) {
    ctx.arc(
      ((i + 1) * canvas.width) / (nbDots + 1),
      100,
      10 * Math.sin(counter * 0.0005 + i / nbDots) ** 2,
      0,
      2 * Math.PI
    )
  }
  ctx.fill()
}

export const SimpleCanvas = args => (
  <div style={{ textAlign: 'center', padding: '10px 0 10px' }}>
    <CanvasComponent {...args} />
  </div>
)

<Canvas>
  <Story
    name="Overview"
    args={{
      onRender: draw,
      disableScrolling: false,
      width: 400,
      height: 200
    }}
  >
    {SimpleCanvas.bind({})}
  </Story>
</Canvas>

### Properties

<ArgsTable story="Overview" />

## Auto resize

Sometimes, you may want to resize the `Canvas` compopnent to fit the element or window that itâ€™s in. To do this, simply bind the `resize` event and, once the event is caught,
resize the canvas by setting on the fly its `width` and `height` properties.

The OKP4 design system provides a simple mechanism for this: the hook `useElementSize`. This hook helps you to dynamically retrieve the width and the height of an HTML element.

For instance:

```tsx
const draw = (canvas, deltaCount) => { ... }
const [ size, divRef ] = useElementSize()

return (
<div style={{ textAlign: 'center', padding: '10px 0 10px' }} ref={divRef}>
  <CanvasComponent 
    width={size?.width} 
    height={size?.height} 
    onRender={draw} />
</div>)
```

export let x = -1
export let y = -1
export let dx = 2
export const drawSize = (canvas, deltaCount) => {
  const ctx = canvas.getContext('2d')
  const text = `Size: ${canvas.width} / ${canvas.height}`
  const metrics = ctx.measureText(text)
  if(x == -1) {
    x = (canvas.width - metrics.width) / 2 
  }
  if(y == -1) {
    y = canvas.height / 2
  }
  ctx.clearRect(0, 0, canvas.width, canvas.height)
  ctx.fillStyle = "#0f224a"
  ctx.fillRect(0, 0, canvas.width, canvas.height)
  ctx.fillStyle = "#ced2d9"
  ctx.font = "25px sans-serif"
  ctx.fillText(text, x, y)
  ctx.fill()
  if(x + metrics.width > canvas.width) {
    x = canvas.width - metrics.width
    dx = -dx
  }
  if(x <= 0) {
    x = 1
    dx = -dx
  }
  x += dx;
}

export const ResizableCanvas = args => {
  const [ size, divRef ] = useElementSize()
  return (
    <div style={{ textAlign: 'center', padding: '10px 0 10px' }} ref={divRef}>
      <CanvasComponent width={size?.width} height={200} {...args} />
    </div>)
}

<Canvas>
  <Story
    name="Auto resize"
    args={{
      onRender: drawSize,
      disableScrolling: false
    }}
  >
    {ResizableCanvas.bind({})}
  </Story>
</Canvas>
